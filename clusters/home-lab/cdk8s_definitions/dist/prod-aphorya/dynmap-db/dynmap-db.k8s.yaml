apiVersion: v1
kind: Secret
metadata:
    labels:
        app.kubernetes.io/instance: dynmap-db
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: postgresql
        app.kubernetes.io/version: 16.1.0
        helm.sh/chart: postgresql-13.2.11
    name: dynmap-db-postgresql
    namespace: prod-aphorya
data:
    postgres-password: ENC[AES256_GCM,data:4pwWbvDL/aKqJTsSWuYYqg==,iv:Kh1eljJSLPQ+Hi/68YUxZ3gWcIWIfUK9A0Mfi6XQqFw=,tag:huMl2uiq4g+Y8z8Sug3ikw==,type:str]
type: Opaque
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2023-11-18T16:19:10Z"
    mac: ENC[AES256_GCM,data:cS78uJvzHCDlH1yjV0xLzRIqhFXUrC48ARQlWvdm6TLWVVglKdidEk7EenPqEwqqVZsROwP6zo16XFrR54rfD7HXUZP7yQeQficLiELZO3TSdFF7clpiQGtEVTjJPGcXhhjKmYm0eG5N50P9nVtTv1uw+BbUlKLYErfXuSQK3jQ=,iv:8lHBxtjAC8muYmyaf1RbdvEI3JurwSvNAHnJDfh2W7g=,tag:7VYKOW6PqSiP18Lh6TPmTw==,type:str]
    pgp:
        - created_at: "2023-11-18T16:19:10Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hQIMA6U2wmTOeuydAQ/9EY/UB8yNNIp/8gp03bipf5y9u0+Yfk9llYyx3PrRbLLB
            PtUquv6ugj9YvwzqBWlrLpZwoe7Zm62kx3XF4OatQjCn0SwVWO2L7+1eOFtZgxpg
            I87OGUsKWnf0K8Rf45Z0aavSJfgqYuzH5EE6EqdW+nKgA7R5Z6kw7uDdY8GUmlRb
            AOXnBdGpNAmn7oNV8MtEziEeytewWdpxWdgaVMUaWIHwShX8VGftCuw5Hf/lXa+H
            7s0rcBk+6dlNI/Ymhlx/1a+1CqKx+sL4aRFF/R/8oNR/h1zSVHlL9PU3nFF3uNQh
            Zq0mxI9tPmTt1MmtvlKKqxM493qPULPHIyNU1F9cbQX54GrZ9qfDuBMGLtiihYNf
            RINDWwFSwvyCZxm0ry4+KbYMdQzhltrGvkLDtL5eYfLBdqwYxe3FdSxhuNEZ+/+A
            eBP9cUC7fO75U0CZYxB0DCP00QEJW2ZD+bHeN4cjYF8KJqg12V7qg3XUSQMUadgK
            JNDdQKFeURpOX6NnDZx8lbG8cSChY9WsqOHpv0l2KOgivMmtjL7Yc41BKSTn6OyG
            i9I79N/MX0bVXt5Em9ABSKl5/yVAYCWJgl5GKBO0RC/lvwhGqLqGofIig6Bna67N
            WQfW4Cuoh8P9bEc2ZmPpRJsp6Qs8aYFzGvNAjz9itXwXbGHzKRsGPz854o7s1VHS
            lwFFpmjJ8J4F0SBZ91gGaLHN5vEyckemAg+VoBv0dmKyg/iuSb+kGLRViVOYy5bk
            4czC4MiJuO2MmH9l/5toNcqluCbQ6tYq8KjHloWj7MwefN+KnuvsthBg5eOS4gtJ
            kK3MnAKB/2LssJT27TBHiagDTzW2LlOrwg1H+GksZgCnewSmvauBAscM9eoUzptd
            QTo0qbBs+Yg=
            =xQ2S
            -----END PGP MESSAGE-----
          fp: 700A165BB7D5DDC51DEDF3C5CBA59BAF26217FDB
    encrypted_regex: ^(data|stringData)$
    version: 3.8.1
---
apiVersion: v1
kind: Service
metadata:
    annotations:
        service.alpha.kubernetes.io/tolerate-unready-endpoints: "true"
    labels:
        app.kubernetes.io/component: primary
        app.kubernetes.io/instance: dynmap-db
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: postgresql
        app.kubernetes.io/version: 16.1.0
        helm.sh/chart: postgresql-13.2.11
    name: dynmap-db-postgresql-hl
    namespace: prod-aphorya
spec:
    clusterIP: None
    ports:
        - name: tcp-postgresql
          port: 5432
          targetPort: tcp-postgresql
    publishNotReadyAddresses: true
    selector:
        app.kubernetes.io/component: primary
        app.kubernetes.io/instance: dynmap-db
        app.kubernetes.io/name: postgresql
    type: ClusterIP
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2023-11-18T16:19:10Z"
    mac: ENC[AES256_GCM,data:cS78uJvzHCDlH1yjV0xLzRIqhFXUrC48ARQlWvdm6TLWVVglKdidEk7EenPqEwqqVZsROwP6zo16XFrR54rfD7HXUZP7yQeQficLiELZO3TSdFF7clpiQGtEVTjJPGcXhhjKmYm0eG5N50P9nVtTv1uw+BbUlKLYErfXuSQK3jQ=,iv:8lHBxtjAC8muYmyaf1RbdvEI3JurwSvNAHnJDfh2W7g=,tag:7VYKOW6PqSiP18Lh6TPmTw==,type:str]
    pgp:
        - created_at: "2023-11-18T16:19:10Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hQIMA6U2wmTOeuydAQ/9EY/UB8yNNIp/8gp03bipf5y9u0+Yfk9llYyx3PrRbLLB
            PtUquv6ugj9YvwzqBWlrLpZwoe7Zm62kx3XF4OatQjCn0SwVWO2L7+1eOFtZgxpg
            I87OGUsKWnf0K8Rf45Z0aavSJfgqYuzH5EE6EqdW+nKgA7R5Z6kw7uDdY8GUmlRb
            AOXnBdGpNAmn7oNV8MtEziEeytewWdpxWdgaVMUaWIHwShX8VGftCuw5Hf/lXa+H
            7s0rcBk+6dlNI/Ymhlx/1a+1CqKx+sL4aRFF/R/8oNR/h1zSVHlL9PU3nFF3uNQh
            Zq0mxI9tPmTt1MmtvlKKqxM493qPULPHIyNU1F9cbQX54GrZ9qfDuBMGLtiihYNf
            RINDWwFSwvyCZxm0ry4+KbYMdQzhltrGvkLDtL5eYfLBdqwYxe3FdSxhuNEZ+/+A
            eBP9cUC7fO75U0CZYxB0DCP00QEJW2ZD+bHeN4cjYF8KJqg12V7qg3XUSQMUadgK
            JNDdQKFeURpOX6NnDZx8lbG8cSChY9WsqOHpv0l2KOgivMmtjL7Yc41BKSTn6OyG
            i9I79N/MX0bVXt5Em9ABSKl5/yVAYCWJgl5GKBO0RC/lvwhGqLqGofIig6Bna67N
            WQfW4Cuoh8P9bEc2ZmPpRJsp6Qs8aYFzGvNAjz9itXwXbGHzKRsGPz854o7s1VHS
            lwFFpmjJ8J4F0SBZ91gGaLHN5vEyckemAg+VoBv0dmKyg/iuSb+kGLRViVOYy5bk
            4czC4MiJuO2MmH9l/5toNcqluCbQ6tYq8KjHloWj7MwefN+KnuvsthBg5eOS4gtJ
            kK3MnAKB/2LssJT27TBHiagDTzW2LlOrwg1H+GksZgCnewSmvauBAscM9eoUzptd
            QTo0qbBs+Yg=
            =xQ2S
            -----END PGP MESSAGE-----
          fp: 700A165BB7D5DDC51DEDF3C5CBA59BAF26217FDB
    encrypted_regex: ^(data|stringData)$
    version: 3.8.1
---
apiVersion: v1
kind: Service
metadata:
    labels:
        app.kubernetes.io/component: primary
        app.kubernetes.io/instance: dynmap-db
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: postgresql
        app.kubernetes.io/version: 16.1.0
        helm.sh/chart: postgresql-13.2.11
    name: dynmap-db-postgresql
    namespace: prod-aphorya
spec:
    ports:
        - name: tcp-postgresql
          port: 5432
          targetPort: tcp-postgresql
    selector:
        app.kubernetes.io/component: primary
        app.kubernetes.io/instance: dynmap-db
        app.kubernetes.io/name: postgresql
    sessionAffinity: None
    type: ClusterIP
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2023-11-18T16:19:10Z"
    mac: ENC[AES256_GCM,data:cS78uJvzHCDlH1yjV0xLzRIqhFXUrC48ARQlWvdm6TLWVVglKdidEk7EenPqEwqqVZsROwP6zo16XFrR54rfD7HXUZP7yQeQficLiELZO3TSdFF7clpiQGtEVTjJPGcXhhjKmYm0eG5N50P9nVtTv1uw+BbUlKLYErfXuSQK3jQ=,iv:8lHBxtjAC8muYmyaf1RbdvEI3JurwSvNAHnJDfh2W7g=,tag:7VYKOW6PqSiP18Lh6TPmTw==,type:str]
    pgp:
        - created_at: "2023-11-18T16:19:10Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hQIMA6U2wmTOeuydAQ/9EY/UB8yNNIp/8gp03bipf5y9u0+Yfk9llYyx3PrRbLLB
            PtUquv6ugj9YvwzqBWlrLpZwoe7Zm62kx3XF4OatQjCn0SwVWO2L7+1eOFtZgxpg
            I87OGUsKWnf0K8Rf45Z0aavSJfgqYuzH5EE6EqdW+nKgA7R5Z6kw7uDdY8GUmlRb
            AOXnBdGpNAmn7oNV8MtEziEeytewWdpxWdgaVMUaWIHwShX8VGftCuw5Hf/lXa+H
            7s0rcBk+6dlNI/Ymhlx/1a+1CqKx+sL4aRFF/R/8oNR/h1zSVHlL9PU3nFF3uNQh
            Zq0mxI9tPmTt1MmtvlKKqxM493qPULPHIyNU1F9cbQX54GrZ9qfDuBMGLtiihYNf
            RINDWwFSwvyCZxm0ry4+KbYMdQzhltrGvkLDtL5eYfLBdqwYxe3FdSxhuNEZ+/+A
            eBP9cUC7fO75U0CZYxB0DCP00QEJW2ZD+bHeN4cjYF8KJqg12V7qg3XUSQMUadgK
            JNDdQKFeURpOX6NnDZx8lbG8cSChY9WsqOHpv0l2KOgivMmtjL7Yc41BKSTn6OyG
            i9I79N/MX0bVXt5Em9ABSKl5/yVAYCWJgl5GKBO0RC/lvwhGqLqGofIig6Bna67N
            WQfW4Cuoh8P9bEc2ZmPpRJsp6Qs8aYFzGvNAjz9itXwXbGHzKRsGPz854o7s1VHS
            lwFFpmjJ8J4F0SBZ91gGaLHN5vEyckemAg+VoBv0dmKyg/iuSb+kGLRViVOYy5bk
            4czC4MiJuO2MmH9l/5toNcqluCbQ6tYq8KjHloWj7MwefN+KnuvsthBg5eOS4gtJ
            kK3MnAKB/2LssJT27TBHiagDTzW2LlOrwg1H+GksZgCnewSmvauBAscM9eoUzptd
            QTo0qbBs+Yg=
            =xQ2S
            -----END PGP MESSAGE-----
          fp: 700A165BB7D5DDC51DEDF3C5CBA59BAF26217FDB
    encrypted_regex: ^(data|stringData)$
    version: 3.8.1
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
    labels:
        app.kubernetes.io/component: primary
        app.kubernetes.io/instance: dynmap-db
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: postgresql
        app.kubernetes.io/version: 16.1.0
        helm.sh/chart: postgresql-13.2.11
    name: dynmap-db-postgresql
    namespace: prod-aphorya
spec:
    replicas: 1
    selector:
        matchLabels:
            app.kubernetes.io/component: primary
            app.kubernetes.io/instance: dynmap-db
            app.kubernetes.io/name: postgresql
    serviceName: dynmap-db-postgresql-hl
    template:
        metadata:
            labels:
                app.kubernetes.io/component: primary
                app.kubernetes.io/instance: dynmap-db
                app.kubernetes.io/managed-by: Helm
                app.kubernetes.io/name: postgresql
                app.kubernetes.io/version: 16.1.0
                helm.sh/chart: postgresql-13.2.11
            name: dynmap-db-postgresql
        spec:
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.kubernetes.io/component: primary
                                    app.kubernetes.io/instance: dynmap-db
                                    app.kubernetes.io/name: postgresql
                            topologyKey: kubernetes.io/hostname
                          weight: 1
            containers:
                - env:
                    - name: BITNAMI_DEBUG
                      value: "false"
                    - name: POSTGRESQL_PORT_NUMBER
                      value: "5432"
                    - name: POSTGRESQL_VOLUME_DIR
                      value: /bitnami/postgresql
                    - name: PGDATA
                      value: /bitnami/postgresql/data
                    - name: POSTGRES_PASSWORD
                      valueFrom:
                        secretKeyRef:
                            key: postgres-password
                            name: dynmap-db-postgresql
                    - name: POSTGRESQL_ENABLE_LDAP
                      value: "no"
                    - name: POSTGRESQL_ENABLE_TLS
                      value: "no"
                    - name: POSTGRESQL_LOG_HOSTNAME
                      value: "false"
                    - name: POSTGRESQL_LOG_CONNECTIONS
                      value: "false"
                    - name: POSTGRESQL_LOG_DISCONNECTIONS
                      value: "false"
                    - name: POSTGRESQL_PGAUDIT_LOG_CATALOG
                      value: "off"
                    - name: POSTGRESQL_CLIENT_MIN_MESSAGES
                      value: error
                    - name: POSTGRESQL_SHARED_PRELOAD_LIBRARIES
                      value: pgaudit
                  image: docker.io/bitnami/postgresql:16.1.0-debian-11-r6
                  imagePullPolicy: IfNotPresent
                  livenessProbe:
                    exec:
                        command:
                            - /bin/sh
                            - -c
                            - exec pg_isready -U "postgres" -h 127.0.0.1 -p 5432
                    failureThreshold: 6
                    initialDelaySeconds: 30
                    periodSeconds: 10
                    successThreshold: 1
                    timeoutSeconds: 5
                  name: postgresql
                  ports:
                    - containerPort: 5432
                      name: tcp-postgresql
                  readinessProbe:
                    exec:
                        command:
                            - /bin/sh
                            - -c
                            - -e
                            - |
                              exec pg_isready -U "postgres" -h 127.0.0.1 -p 5432
                              [ -f /opt/bitnami/postgresql/tmp/.initialized ] || [ -f /bitnami/postgresql/.initialized ]
                    failureThreshold: 6
                    initialDelaySeconds: 5
                    periodSeconds: 10
                    successThreshold: 1
                    timeoutSeconds: 5
                  resources:
                    limits: {}
                    requests:
                        cpu: 250m
                        memory: 256Mi
                  securityContext:
                    allowPrivilegeEscalation: false
                    capabilities:
                        drop:
                            - ALL
                    privileged: false
                    readOnlyRootFilesystem: false
                    runAsNonRoot: true
                    runAsUser: 1001
                    seccompProfile:
                        type: RuntimeDefault
                  volumeMounts:
                    - mountPath: /dev/shm
                      name: dshm
                    - mountPath: /bitnami/postgresql
                      name: data
            hostIPC: false
            hostNetwork: false
            securityContext:
                fsGroup: 1001
            serviceAccountName: default
            volumes:
                - emptyDir:
                    medium: Memory
                  name: dshm
    updateStrategy:
        rollingUpdate: {}
        type: RollingUpdate
    volumeClaimTemplates:
        - apiVersion: v1
          kind: PersistentVolumeClaim
          metadata:
            name: data
          spec:
            accessModes:
                - ReadWriteOnce
            resources:
                requests:
                    storage: 8Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2023-11-18T16:19:10Z"
    mac: ENC[AES256_GCM,data:cS78uJvzHCDlH1yjV0xLzRIqhFXUrC48ARQlWvdm6TLWVVglKdidEk7EenPqEwqqVZsROwP6zo16XFrR54rfD7HXUZP7yQeQficLiELZO3TSdFF7clpiQGtEVTjJPGcXhhjKmYm0eG5N50P9nVtTv1uw+BbUlKLYErfXuSQK3jQ=,iv:8lHBxtjAC8muYmyaf1RbdvEI3JurwSvNAHnJDfh2W7g=,tag:7VYKOW6PqSiP18Lh6TPmTw==,type:str]
    pgp:
        - created_at: "2023-11-18T16:19:10Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hQIMA6U2wmTOeuydAQ/9EY/UB8yNNIp/8gp03bipf5y9u0+Yfk9llYyx3PrRbLLB
            PtUquv6ugj9YvwzqBWlrLpZwoe7Zm62kx3XF4OatQjCn0SwVWO2L7+1eOFtZgxpg
            I87OGUsKWnf0K8Rf45Z0aavSJfgqYuzH5EE6EqdW+nKgA7R5Z6kw7uDdY8GUmlRb
            AOXnBdGpNAmn7oNV8MtEziEeytewWdpxWdgaVMUaWIHwShX8VGftCuw5Hf/lXa+H
            7s0rcBk+6dlNI/Ymhlx/1a+1CqKx+sL4aRFF/R/8oNR/h1zSVHlL9PU3nFF3uNQh
            Zq0mxI9tPmTt1MmtvlKKqxM493qPULPHIyNU1F9cbQX54GrZ9qfDuBMGLtiihYNf
            RINDWwFSwvyCZxm0ry4+KbYMdQzhltrGvkLDtL5eYfLBdqwYxe3FdSxhuNEZ+/+A
            eBP9cUC7fO75U0CZYxB0DCP00QEJW2ZD+bHeN4cjYF8KJqg12V7qg3XUSQMUadgK
            JNDdQKFeURpOX6NnDZx8lbG8cSChY9WsqOHpv0l2KOgivMmtjL7Yc41BKSTn6OyG
            i9I79N/MX0bVXt5Em9ABSKl5/yVAYCWJgl5GKBO0RC/lvwhGqLqGofIig6Bna67N
            WQfW4Cuoh8P9bEc2ZmPpRJsp6Qs8aYFzGvNAjz9itXwXbGHzKRsGPz854o7s1VHS
            lwFFpmjJ8J4F0SBZ91gGaLHN5vEyckemAg+VoBv0dmKyg/iuSb+kGLRViVOYy5bk
            4czC4MiJuO2MmH9l/5toNcqluCbQ6tYq8KjHloWj7MwefN+KnuvsthBg5eOS4gtJ
            kK3MnAKB/2LssJT27TBHiagDTzW2LlOrwg1H+GksZgCnewSmvauBAscM9eoUzptd
            QTo0qbBs+Yg=
            =xQ2S
            -----END PGP MESSAGE-----
          fp: 700A165BB7D5DDC51DEDF3C5CBA59BAF26217FDB
    encrypted_regex: ^(data|stringData)$
    version: 3.8.1
