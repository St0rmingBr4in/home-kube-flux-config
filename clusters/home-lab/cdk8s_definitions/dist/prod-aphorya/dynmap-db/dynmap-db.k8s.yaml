apiVersion: v1
kind: Secret
metadata:
    labels:
        app.kubernetes.io/instance: dynmap-db
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: postgresql
        app.kubernetes.io/version: 16.1.0
        helm.sh/chart: postgresql-13.2.11
    name: dynmap-db-postgresql
    namespace: prod-aphorya
data:
    postgres-password: ENC[AES256_GCM,data:dCT8GxABOIGxMjA1tQgoQw==,iv:vETmHFaHfWryGGWdSSH1/mOXfIZz+h2DQ0/WKz9baiU=,tag:7teMo++PbiDM0K+XoJGWhQ==,type:str]
type: Opaque
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2023-11-18T16:54:50Z"
    mac: ENC[AES256_GCM,data:k3MxkRaAHadml+LvGJbJfGi3CNXJ8WmBTNTnzWppLN++vKb9OOZLc1Gv38G9tHT7DQzcgKMGJaJhqa1BXfdDXXRNP4WrtZ9htrKKnJ3VoesMLhoRyKaeplHoqpy5viPj0cXVTJ+V+Xrb7oKCsstR49mrwYnxkZnxfitqwcSKgkM=,iv:AetcPalTUmD/SbWB4aySQxLudzCendsmePOvMrk2Bi8=,tag:mlD4unhuD3STSrOfiDQ4SQ==,type:str]
    pgp:
        - created_at: "2023-11-18T16:54:50Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hQIMA6U2wmTOeuydAQ//ceUe3Jfe1nOYbObGUnM9PLVN6kKYNV12eicasbMGP42y
            yhXH1mA86cxsYMSka+lBvlXEu9ZVQ2xaVGUQ2XAJgHrEAztTP4ettjgwqyqf1l+5
            mKYYAR9O+o1xB7QzjW3OrtgCLxuL37CKKkeKllIrSIgm37ixsTjyW6NO+sCIOUgQ
            FcaA7vJG9G+rvDq5nDQwmFJgzlL81kAgZXQJhuKzPEJcktpIEnWVzgLzirolLje6
            vil3BBScig1IXcPxCFkujeNFpsf6HrK/pB7161WrrdKpS3VVP1c/hqqrVTojkgSP
            VEo5LjBa59vREDkOAi474F79YjM9E6U29HkXJXAG7x7D6HjZwOXYtxw7KQPUZqyN
            xe3j8Er+9Ydt7QF1YdSEWAGGGXUqx85t4ZOQVOEDacgc7Mc1r85Tn1on4zJsOnw0
            wk/pEIyCSnXu69jHXiAzdVXVPErf1qIdrNUHI+v90ixJXIENw6uILc/SJ/nuvaAL
            aBcxbm5DgLeKh35Ssb64GO7xZbOW2nzY8YPbtMIE0C2tiY9KXLU9GgWb7PkDuhXK
            LwCBr1hK5kqnvJgrOmj69N2I5k6ne2UpPadU5nvzmbd1p5Q/6xi7h0w8kbKvpvRR
            X45ybbn5yaRfdNjpVAzdo6iDC1c1Hysi1iSeclSlJfi2LYyKBhPUNFaJniwBR8LS
            lAFyyqp009w09UYX+MiNNp2knx+9gqgwtkDvPTuUKWO8E+0ZarvgvqdZs+EpqZ1t
            KvqdYx3SDFQJNDklfF5jHMLjP38JcnHwgZVYRnv+I5MqeFQqFv7uT8jbyHr+WMUZ
            VWtsZfjm2AR4r1uziBqLjNHT79EKSMvQ9IBfXzwBnkngICRe4EdL/gXBKP9mU7Ez
            B4ytBJU=
            =9zbQ
            -----END PGP MESSAGE-----
          fp: 700A165BB7D5DDC51DEDF3C5CBA59BAF26217FDB
    encrypted_regex: ^(data|stringData)$
    version: 3.8.1
---
apiVersion: v1
kind: Service
metadata:
    annotations:
        service.alpha.kubernetes.io/tolerate-unready-endpoints: "true"
    labels:
        app.kubernetes.io/component: primary
        app.kubernetes.io/instance: dynmap-db
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: postgresql
        app.kubernetes.io/version: 16.1.0
        helm.sh/chart: postgresql-13.2.11
    name: dynmap-db-postgresql-hl
    namespace: prod-aphorya
spec:
    clusterIP: None
    ports:
        - name: tcp-postgresql
          port: 5432
          targetPort: tcp-postgresql
    publishNotReadyAddresses: true
    selector:
        app.kubernetes.io/component: primary
        app.kubernetes.io/instance: dynmap-db
        app.kubernetes.io/name: postgresql
    type: ClusterIP
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2023-11-18T16:54:50Z"
    mac: ENC[AES256_GCM,data:k3MxkRaAHadml+LvGJbJfGi3CNXJ8WmBTNTnzWppLN++vKb9OOZLc1Gv38G9tHT7DQzcgKMGJaJhqa1BXfdDXXRNP4WrtZ9htrKKnJ3VoesMLhoRyKaeplHoqpy5viPj0cXVTJ+V+Xrb7oKCsstR49mrwYnxkZnxfitqwcSKgkM=,iv:AetcPalTUmD/SbWB4aySQxLudzCendsmePOvMrk2Bi8=,tag:mlD4unhuD3STSrOfiDQ4SQ==,type:str]
    pgp:
        - created_at: "2023-11-18T16:54:50Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hQIMA6U2wmTOeuydAQ//ceUe3Jfe1nOYbObGUnM9PLVN6kKYNV12eicasbMGP42y
            yhXH1mA86cxsYMSka+lBvlXEu9ZVQ2xaVGUQ2XAJgHrEAztTP4ettjgwqyqf1l+5
            mKYYAR9O+o1xB7QzjW3OrtgCLxuL37CKKkeKllIrSIgm37ixsTjyW6NO+sCIOUgQ
            FcaA7vJG9G+rvDq5nDQwmFJgzlL81kAgZXQJhuKzPEJcktpIEnWVzgLzirolLje6
            vil3BBScig1IXcPxCFkujeNFpsf6HrK/pB7161WrrdKpS3VVP1c/hqqrVTojkgSP
            VEo5LjBa59vREDkOAi474F79YjM9E6U29HkXJXAG7x7D6HjZwOXYtxw7KQPUZqyN
            xe3j8Er+9Ydt7QF1YdSEWAGGGXUqx85t4ZOQVOEDacgc7Mc1r85Tn1on4zJsOnw0
            wk/pEIyCSnXu69jHXiAzdVXVPErf1qIdrNUHI+v90ixJXIENw6uILc/SJ/nuvaAL
            aBcxbm5DgLeKh35Ssb64GO7xZbOW2nzY8YPbtMIE0C2tiY9KXLU9GgWb7PkDuhXK
            LwCBr1hK5kqnvJgrOmj69N2I5k6ne2UpPadU5nvzmbd1p5Q/6xi7h0w8kbKvpvRR
            X45ybbn5yaRfdNjpVAzdo6iDC1c1Hysi1iSeclSlJfi2LYyKBhPUNFaJniwBR8LS
            lAFyyqp009w09UYX+MiNNp2knx+9gqgwtkDvPTuUKWO8E+0ZarvgvqdZs+EpqZ1t
            KvqdYx3SDFQJNDklfF5jHMLjP38JcnHwgZVYRnv+I5MqeFQqFv7uT8jbyHr+WMUZ
            VWtsZfjm2AR4r1uziBqLjNHT79EKSMvQ9IBfXzwBnkngICRe4EdL/gXBKP9mU7Ez
            B4ytBJU=
            =9zbQ
            -----END PGP MESSAGE-----
          fp: 700A165BB7D5DDC51DEDF3C5CBA59BAF26217FDB
    encrypted_regex: ^(data|stringData)$
    version: 3.8.1
---
apiVersion: v1
kind: Service
metadata:
    labels:
        app.kubernetes.io/component: primary
        app.kubernetes.io/instance: dynmap-db
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: postgresql
        app.kubernetes.io/version: 16.1.0
        helm.sh/chart: postgresql-13.2.11
    name: dynmap-db-postgresql
    namespace: prod-aphorya
spec:
    ports:
        - name: tcp-postgresql
          port: 5432
          targetPort: tcp-postgresql
    selector:
        app.kubernetes.io/component: primary
        app.kubernetes.io/instance: dynmap-db
        app.kubernetes.io/name: postgresql
    sessionAffinity: None
    type: ClusterIP
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2023-11-18T16:54:50Z"
    mac: ENC[AES256_GCM,data:k3MxkRaAHadml+LvGJbJfGi3CNXJ8WmBTNTnzWppLN++vKb9OOZLc1Gv38G9tHT7DQzcgKMGJaJhqa1BXfdDXXRNP4WrtZ9htrKKnJ3VoesMLhoRyKaeplHoqpy5viPj0cXVTJ+V+Xrb7oKCsstR49mrwYnxkZnxfitqwcSKgkM=,iv:AetcPalTUmD/SbWB4aySQxLudzCendsmePOvMrk2Bi8=,tag:mlD4unhuD3STSrOfiDQ4SQ==,type:str]
    pgp:
        - created_at: "2023-11-18T16:54:50Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hQIMA6U2wmTOeuydAQ//ceUe3Jfe1nOYbObGUnM9PLVN6kKYNV12eicasbMGP42y
            yhXH1mA86cxsYMSka+lBvlXEu9ZVQ2xaVGUQ2XAJgHrEAztTP4ettjgwqyqf1l+5
            mKYYAR9O+o1xB7QzjW3OrtgCLxuL37CKKkeKllIrSIgm37ixsTjyW6NO+sCIOUgQ
            FcaA7vJG9G+rvDq5nDQwmFJgzlL81kAgZXQJhuKzPEJcktpIEnWVzgLzirolLje6
            vil3BBScig1IXcPxCFkujeNFpsf6HrK/pB7161WrrdKpS3VVP1c/hqqrVTojkgSP
            VEo5LjBa59vREDkOAi474F79YjM9E6U29HkXJXAG7x7D6HjZwOXYtxw7KQPUZqyN
            xe3j8Er+9Ydt7QF1YdSEWAGGGXUqx85t4ZOQVOEDacgc7Mc1r85Tn1on4zJsOnw0
            wk/pEIyCSnXu69jHXiAzdVXVPErf1qIdrNUHI+v90ixJXIENw6uILc/SJ/nuvaAL
            aBcxbm5DgLeKh35Ssb64GO7xZbOW2nzY8YPbtMIE0C2tiY9KXLU9GgWb7PkDuhXK
            LwCBr1hK5kqnvJgrOmj69N2I5k6ne2UpPadU5nvzmbd1p5Q/6xi7h0w8kbKvpvRR
            X45ybbn5yaRfdNjpVAzdo6iDC1c1Hysi1iSeclSlJfi2LYyKBhPUNFaJniwBR8LS
            lAFyyqp009w09UYX+MiNNp2knx+9gqgwtkDvPTuUKWO8E+0ZarvgvqdZs+EpqZ1t
            KvqdYx3SDFQJNDklfF5jHMLjP38JcnHwgZVYRnv+I5MqeFQqFv7uT8jbyHr+WMUZ
            VWtsZfjm2AR4r1uziBqLjNHT79EKSMvQ9IBfXzwBnkngICRe4EdL/gXBKP9mU7Ez
            B4ytBJU=
            =9zbQ
            -----END PGP MESSAGE-----
          fp: 700A165BB7D5DDC51DEDF3C5CBA59BAF26217FDB
    encrypted_regex: ^(data|stringData)$
    version: 3.8.1
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
    labels:
        app.kubernetes.io/component: primary
        app.kubernetes.io/instance: dynmap-db
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: postgresql
        app.kubernetes.io/version: 16.1.0
        helm.sh/chart: postgresql-13.2.11
    name: dynmap-db-postgresql
    namespace: prod-aphorya
spec:
    replicas: 1
    selector:
        matchLabels:
            app.kubernetes.io/component: primary
            app.kubernetes.io/instance: dynmap-db
            app.kubernetes.io/name: postgresql
    serviceName: dynmap-db-postgresql-hl
    template:
        metadata:
            labels:
                app.kubernetes.io/component: primary
                app.kubernetes.io/instance: dynmap-db
                app.kubernetes.io/managed-by: Helm
                app.kubernetes.io/name: postgresql
                app.kubernetes.io/version: 16.1.0
                helm.sh/chart: postgresql-13.2.11
            name: dynmap-db-postgresql
        spec:
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - podAffinityTerm:
                            labelSelector:
                                matchLabels:
                                    app.kubernetes.io/component: primary
                                    app.kubernetes.io/instance: dynmap-db
                                    app.kubernetes.io/name: postgresql
                            topologyKey: kubernetes.io/hostname
                          weight: 1
            containers:
                - env:
                    - name: BITNAMI_DEBUG
                      value: "false"
                    - name: POSTGRESQL_PORT_NUMBER
                      value: "5432"
                    - name: POSTGRESQL_VOLUME_DIR
                      value: /bitnami/postgresql
                    - name: PGDATA
                      value: /bitnami/postgresql/data
                    - name: POSTGRES_PASSWORD
                      valueFrom:
                        secretKeyRef:
                            key: postgres-password
                            name: dynmap-db-postgresql
                    - name: POSTGRESQL_ENABLE_LDAP
                      value: "no"
                    - name: POSTGRESQL_ENABLE_TLS
                      value: "no"
                    - name: POSTGRESQL_LOG_HOSTNAME
                      value: "false"
                    - name: POSTGRESQL_LOG_CONNECTIONS
                      value: "false"
                    - name: POSTGRESQL_LOG_DISCONNECTIONS
                      value: "false"
                    - name: POSTGRESQL_PGAUDIT_LOG_CATALOG
                      value: "off"
                    - name: POSTGRESQL_CLIENT_MIN_MESSAGES
                      value: error
                    - name: POSTGRESQL_SHARED_PRELOAD_LIBRARIES
                      value: pgaudit
                  image: docker.io/bitnami/postgresql:16.1.0-debian-11-r6
                  imagePullPolicy: IfNotPresent
                  livenessProbe:
                    exec:
                        command:
                            - /bin/sh
                            - -c
                            - exec pg_isready -U "postgres" -h 127.0.0.1 -p 5432
                    failureThreshold: 6
                    initialDelaySeconds: 30
                    periodSeconds: 10
                    successThreshold: 1
                    timeoutSeconds: 5
                  name: postgresql
                  ports:
                    - containerPort: 5432
                      name: tcp-postgresql
                  readinessProbe:
                    exec:
                        command:
                            - /bin/sh
                            - -c
                            - -e
                            - |
                              exec pg_isready -U "postgres" -h 127.0.0.1 -p 5432
                              [ -f /opt/bitnami/postgresql/tmp/.initialized ] || [ -f /bitnami/postgresql/.initialized ]
                    failureThreshold: 6
                    initialDelaySeconds: 5
                    periodSeconds: 10
                    successThreshold: 1
                    timeoutSeconds: 5
                  resources:
                    limits:
                        memory: 256Mi
                    requests:
                        cpu: 250m
                        memory: 256Mi
                  securityContext:
                    allowPrivilegeEscalation: false
                    capabilities:
                        drop:
                            - ALL
                    privileged: false
                    readOnlyRootFilesystem: false
                    runAsNonRoot: true
                    runAsUser: 1001
                    seccompProfile:
                        type: RuntimeDefault
                  volumeMounts:
                    - mountPath: /dev/shm
                      name: dshm
                    - mountPath: /bitnami/postgresql
                      name: data
            hostIPC: false
            hostNetwork: false
            securityContext:
                fsGroup: 1001
            serviceAccountName: default
            volumes:
                - emptyDir:
                    medium: Memory
                  name: dshm
    updateStrategy:
        rollingUpdate: {}
        type: RollingUpdate
    volumeClaimTemplates:
        - apiVersion: v1
          kind: PersistentVolumeClaim
          metadata:
            name: data
          spec:
            accessModes:
                - ReadWriteOnce
            resources:
                requests:
                    storage: 8Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2023-11-18T16:54:50Z"
    mac: ENC[AES256_GCM,data:k3MxkRaAHadml+LvGJbJfGi3CNXJ8WmBTNTnzWppLN++vKb9OOZLc1Gv38G9tHT7DQzcgKMGJaJhqa1BXfdDXXRNP4WrtZ9htrKKnJ3VoesMLhoRyKaeplHoqpy5viPj0cXVTJ+V+Xrb7oKCsstR49mrwYnxkZnxfitqwcSKgkM=,iv:AetcPalTUmD/SbWB4aySQxLudzCendsmePOvMrk2Bi8=,tag:mlD4unhuD3STSrOfiDQ4SQ==,type:str]
    pgp:
        - created_at: "2023-11-18T16:54:50Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hQIMA6U2wmTOeuydAQ//ceUe3Jfe1nOYbObGUnM9PLVN6kKYNV12eicasbMGP42y
            yhXH1mA86cxsYMSka+lBvlXEu9ZVQ2xaVGUQ2XAJgHrEAztTP4ettjgwqyqf1l+5
            mKYYAR9O+o1xB7QzjW3OrtgCLxuL37CKKkeKllIrSIgm37ixsTjyW6NO+sCIOUgQ
            FcaA7vJG9G+rvDq5nDQwmFJgzlL81kAgZXQJhuKzPEJcktpIEnWVzgLzirolLje6
            vil3BBScig1IXcPxCFkujeNFpsf6HrK/pB7161WrrdKpS3VVP1c/hqqrVTojkgSP
            VEo5LjBa59vREDkOAi474F79YjM9E6U29HkXJXAG7x7D6HjZwOXYtxw7KQPUZqyN
            xe3j8Er+9Ydt7QF1YdSEWAGGGXUqx85t4ZOQVOEDacgc7Mc1r85Tn1on4zJsOnw0
            wk/pEIyCSnXu69jHXiAzdVXVPErf1qIdrNUHI+v90ixJXIENw6uILc/SJ/nuvaAL
            aBcxbm5DgLeKh35Ssb64GO7xZbOW2nzY8YPbtMIE0C2tiY9KXLU9GgWb7PkDuhXK
            LwCBr1hK5kqnvJgrOmj69N2I5k6ne2UpPadU5nvzmbd1p5Q/6xi7h0w8kbKvpvRR
            X45ybbn5yaRfdNjpVAzdo6iDC1c1Hysi1iSeclSlJfi2LYyKBhPUNFaJniwBR8LS
            lAFyyqp009w09UYX+MiNNp2knx+9gqgwtkDvPTuUKWO8E+0ZarvgvqdZs+EpqZ1t
            KvqdYx3SDFQJNDklfF5jHMLjP38JcnHwgZVYRnv+I5MqeFQqFv7uT8jbyHr+WMUZ
            VWtsZfjm2AR4r1uziBqLjNHT79EKSMvQ9IBfXzwBnkngICRe4EdL/gXBKP9mU7Ez
            B4ytBJU=
            =9zbQ
            -----END PGP MESSAGE-----
          fp: 700A165BB7D5DDC51DEDF3C5CBA59BAF26217FDB
    encrypted_regex: ^(data|stringData)$
    version: 3.8.1
