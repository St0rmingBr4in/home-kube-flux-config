---
operator:
  verify:
    enabled: false
  traefik:
    namespace: prod-infra

ingress:
  main:
    integrations:
      traefik:
        enableFixedMiddlewares: false
        middlewares:
          - name: basic-auth
            namespace: prod-infra
    enabled: true
    hosts:
      - host: qbittorrent.st0rmingbr4in.com
        paths:
          - path: /

resources:
  limits:
    memory: 1Gi
  requests:
    cpu: 100m
    memory: 1Gi

persistence:
  config:
    enabled: true
    existingClaim: qbittorrent-config
  downloads:
    enabled: true
    existingClaim: media-downloads
    mountPath: /downloads

env:
  TZ: Europe/Paris

securityContext:
  runAsUser: 1031
  runAsGroup: 100

# NordVPN sidecar configuration using TrueCharts pattern
workload:
  main:
    podSpec:
      containers:
        nordvpn:
          enabled: true
          primary: false
          imageSelector: nordvpnImage
          env:
            TOKEN:
              secretKeyRef:
                name: nordvpn-credentials
                key: token
            CONNECT: "Netherlands"
            TECHNOLOGY: "NordLynx"
            NETWORK: "10.0.0.0/8,192.168.0.0/16,172.16.0.0/12"
            NET_LOCAL: "10.0.0.0/8,192.168.0.0/16,172.16.0.0/12"
            WHITELIST: "10.0.0.0/8,192.168.0.0/16,172.16.0.0/12"
          probes:
            liveness:
              enabled: false
            readiness:
              enabled: false
            startup:
              enabled: false
          securityContext:
            capabilities:
              add:
                - NET_ADMIN
                - SYS_MODULE
            privileged: true
          resources:
            limits:
              memory: 256Mi
            requests:
              cpu: 100m
              memory: 256Mi

# NordVPN image configuration
nordvpnImage:
  repository: ghcr.io/bubuntux/nordvpn
  tag: latest
  pullPolicy: Always

# Secret definition for templating (disabled - using external Vault secret)
secret:
  nordvpn-credentials:
    enabled: false
    type: Opaque
    data:
      token: "placeholder"

# Network configuration to route through VPN
podOptions:
  dnsPolicy: "None"
  dnsConfig:
    nameservers:
      - "103.86.96.100"
      - "103.86.99.100"
    searches:
      - "prod-media.svc.cluster.local"
      - "svc.cluster.local"
      - "cluster.local"
  shareProcessNamespace: true
