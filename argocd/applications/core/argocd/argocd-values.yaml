# ArgoCD Configuration (Bootstrap + Self-Management)
# Access: kubectl port-forward svc/argocd-server -n argocd 8080:443
# URL: https://localhost:8080

# Application Controller (main workload) - actual usage: 307m CPU, 294Mi memory
controller:
  resources:
    limits:
      memory: 512Mi # Higher than usage with headroom
    requests:
      cpu: 300m # Based on actual usage
      memory: 512Mi # Same as limit for guaranteed QoS

# Repository Server - processes Helm charts and Git repos (was getting OOMKilled at 256Mi)
repoServer:
  resources:
    limits:
      memory: 2Gi # Increased significantly for complex Helm chart processing (VSO, etc.)
    requests:
      cpu: 50m # Slightly increased for better performance
      memory: 2Gi # Same as limit for guaranteed QoS

# ArgoCD Server - actual usage: 3m CPU, 25Mi memory
server:
  resources:
    limits:
      memory: 64Mi # Generous headroom
    requests:
      cpu: 10m # Based on actual usage
      memory: 64Mi # Same as limit for guaranteed QoS

  service:
    type: ClusterIP

  # Disable ingress - use port forwarding for access
  ingress:
    enabled: false

# Dex Server - actual usage: 1m CPU, 25Mi memory
dex:
  resources:
    limits:
      memory: 64Mi # Generous headroom
    requests:
      cpu: 5m # Based on actual usage
      memory: 64Mi # Same as limit for guaranteed QoS

# Redis - actual usage: 7m CPU, 10Mi memory
redis:
  resources:
    limits:
      memory: 32Mi # Generous headroom
    requests:
      cpu: 10m # Based on actual usage
      memory: 32Mi # Same as limit for guaranteed QoS

# Notifications Controller - actual usage: 1m CPU, 31Mi memory
notifications:
  resources:
    limits:
      memory: 64Mi # Generous headroom
    requests:
      cpu: 5m # Based on actual usage
      memory: 64Mi # Same as limit for guaranteed QoS

# ApplicationSet Controller - actual usage: 2m CPU, 27Mi memory
applicationSet:
  resources:
    limits:
      memory: 64Mi # Generous headroom
    requests:
      cpu: 5m # Based on actual usage
      memory: 64Mi # Same as limit for guaranteed QoS

configs:
  # ArgoCD configuration
  cm:
    # URL for port forwarding access
    url: https://localhost:8080

    # Repository configuration for self-management
    repositories: |
      - name: home-kube-flux-config
        type: git
        url: https://github.com/St0rmingBr4in/home-kube-flux-config
